{% extends "layout.html" %}
{% block title %}Index{% endblock %}
{% block content %}
    <style>
        iframe:focus {
            outline: none;
        }

        iframe[seamless] {
            display: block;
            width: 100%;
            border: none;
        }
    </style>
    <script>
        function set_time() {
            let input = document.getElementById("new_speed");
            let xhr = new XMLHttpRequest();
            xhr.open("POST", "/clock/speed?new=" + input.value, true);
            xhr.send(null)
        }

        function pause_resume() {
            let xhr = new XMLHttpRequest();
            xhr.open("POST", "/clock/switch", true);
            xhr.send(null)
        }

        function update_table() {
            fetch("/schedule/list")
                .then(function (response) {
                    return response.text();
                })
                .then(function (data) {
                    document.getElementById("table").innerHTML = data;
                    setTimeout(update_table, 1000)
                })
                .catch(function (error) {
                    console.log(error);
                    setTimeout(update_table, 1000)
                })
        }

        update_table();

        function update_time() {
            fetch("/clock/info")
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    document.getElementById("current_time").innerHTML = "Time: " + data[0];
                    document.getElementById("current_speed").innerHTML = "Speed: " + data[1] + "x";
                    let status = data[2] === "True" ? "Paused" : "Running";
                    document.getElementById("pause_resume").value = data[2] === "True" ? "Resume" : "Pause";
                    document.getElementById("current_status").style.color = data[2] === "True" ? "orange" : "limegreen";
                    document.getElementById("current_status").innerHTML = "Status: " + status;
                    setTimeout(update_time, 1000)
                })
                .catch(function (error) {
                    console.log(error);
                    setTimeout(update_time, 1000)
                })
        }

        update_time();

    </script>
    <h2>Informations</h2>
    <h3 id="current_time"></h3>
    <h3 id="current_speed"></h3>
    <h3 id="current_status"></h3>
    <h2>Actions</h2>
    <div style="margin-bottom: 1%">
        <input id='new_speed' placeholder="new speed" type="number" required min="0" step="0.1">
        <input type='button' value="Change speed" onclick="set_time()">
    </div>
    <div>
        <input id='pause_resume' type='button' value="" onclick="pause_resume()">
    </div>
    <h2>List</h2>
    <div id="table">
    </div>
    <iframe name="nowhere" style="display:none"></iframe>
{% endblock %}